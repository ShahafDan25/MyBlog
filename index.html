<!DOCTYPE html>
<html>
    <head>
        <title> Shahafster Blog </title>
        <meta charset = utf-8 />
        <meta name = "viewport" content = "width=device-width, initial-scale=1">
        <!-- BOOTSTRAP LINKS AND SCRIPTS -->
        <!-- <link rel = "stylesheet" href = "https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> -->
        <!-- <script src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>  -->

        <!-- JQUERY AND AJAX -->
        <script src = "https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity = "sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin = "anonymous"></script>
        <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!-- FONTAWESOME ICON --> 
        <script src = "https://use.fontawesome.com/9f04ec4af7.js"></script>

        <!-- ALERTIFY.JS: JavaScrip and CSS -->
        <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.rtl.min.css"/>


        <!-- MY CSS FILE -->
        <link rel = "stylesheet" type = "text/css" href = "main.css">

        <!-- MY JAVASCRIPT FILE -->
        <script src = "main.js"></script>

    </head>
    <!---------------------------------------- CONTENT: ------------------------------------------------>
    
    <body>
        <header>
            <button class = "show-sidebar-btn" onclick = "slideSidebar();"><i class = "fa fa-bars"></i></button>
            <h3 class = "header-page-name" onclick = "location.replace('add.html');">Shahafster</h3>
            <div class="my-bitmoji-stickerpicker-icon-target"></div>
        </header>
        <div class = "sidebar inline" id = "sidebar">
            <a class = "sidebar-option" onclick = "slideSidebar();"> Blog </a>
            <a class = "sidebar-option" href = "https://shahaf-dan.com/"> My Portfolio </a>
            <a class = "sidebar-option" href = "https://twitter.com/shahaf_dan"> Twitter </a>
        </div>
        <div class = "container container-without-sidebar inline" id = "container">
            
            <div class = "blog" id = "blog">
                <!-- TO BE POPULATED WITH PHP -->
            </div>
        </div>
        <div id = "register-form" style = "display: none" class = "register-form">
            <form id = "registration-form">
                <h2> You need to register to like posts </h2>
                <label> First Name </label>
                <input type = "text" id = "register-first-name" placeholder = "  ..."/>
                <br>
                <label> Last Name </label>
                <input type = "text" id = "register-last-name" placeholder = "  ..."/>
                <br>
                <label> Create PIN </label>
                <input type = "number" id = "register-pin" placeholder = "  ..."/>
            </form>
            
        </div>
    </body>
    <footer>
        #MindsetGrowth
    </footer>
    <script>
        $(document).ready(function() {
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-blog"
                },
                success: function(data) {
                    $("#blog").html(data);
                }
            });
        });


        function likePost(id) {
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "check-login-cookie",
                    postid: id
                },
                success: function(data) {
                    if($.trim(data) == "notfound") {
                        document.getElementById("register-form").style.display = "block";
                        //create account
                        register(id);
                    }
                    else {
                        // alertify.success("Welcome " + data + "!");
                        $.ajax({
                            type: "POST",
                            url: "main.php",
                            data: {
                                message: "update-likes-amount",
                                postid: id
                            },
                            success: function(data) {
                                $("#likes-label-" + id).html(data);
                                $("#like-icon-"+id).toggleClass("fa-heart-o");
                            $("#like-icon-"+id).toggleClass("fa-heart");
                            }
                        });    
                    }
                }
            });
        }

        // $("#registration-form").submit(function(event) {
        //     event.preventDefault();
        // }); 
        // TODO: Take care of cases where fields are unfilled

        function register(id) {
            var form = document.getElementById("register-form");
            alertify.confirm(
                form,
                function() { //register
                    $.ajax({
                        type: "POST",
                        url: "main.php",
                        data: {
                            message: "set-account",
                            firstname: $("#register-first-name").val(),
                            lastname: $("#register-last-name").val(),
                            pin: $("#register-pin").val(),
                            post: id
                        },
                        success: function(data) {
                            if($.trim(data) == "true") {
                                $("#like-icon-"+id).toggleClass("fa-heart-o");
                                $("#like-icon-"+id).toggleClass("fa-heart");
                                alertify.success("Welcome, " + $("#register-first-name").val());
                            }
                            else if($.trim(data) == "false") {
                                alertify.message ("PIN taken").ondismiss = function() {
                                    $("#register-pin").val() = "";
                                    register(id); 
                                }
                            }
                        }
                    }); 
                },
                function () { //cancel
                    alertify.message("Maybe Later...");
                    document.getElementById("register-form").style.display = "none";
                }
            ).set({labels:{ok: 'Submit', cancel: 'Cancel'}, padding: false});
            
        }
    </script>

</html>